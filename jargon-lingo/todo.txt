user details:

-file browser
-add user wizard
-dates (display with jquery?)
-user metadata (dialog?)
-user group mgmnt
-user audit
-user group tray and drag of group membership

user connection mgmnt (including jargon-core)


-identities on the grid
-message area formatting

-error scrubbing for ajax, base on ajax onerror since return codes now implemented

2694E8




var dataTree;

function retriveBrowserFirstView() {
	var url = "/data/data_browser/ajax_data_browser_dir_request?dir=/";	
	lcSendValueAndCallbackWithJsonAfterErrorCheck(url, "#data_tree_div", browserFirstViewRetrieved);

}

function buildDataForNodeRequest(n) {
	//alert("n was:" + n);
	var nodeData = { "dir" : "/"};
	return nodeData;
}


function browserFirstViewRetrieved(data) {
	dataTree = $("#data_tree_div").jstree({ 
		"core" : {  },
		"html_data" : {
			            "data" : "<li id='root'><a href='#'>/</a></li>"
				        },
		"plugins" : [ "themes", "html_data", "crmm" ]
	});
		
	dataTree.bind("click", function(event) { nodeSelected(event)});
	
	var directoryList = data.directoryList;
	
	if (directoryList == null) {
		return;
	}
	
	var ref = $.jstree._reference("#root");
	
	//var children = $.jstree._reference("#root")._get_children(ref);
	
	for (i = 0; i < directoryList.length; i++) {
		var entry = directoryList[i];
		//var nodeData = { "state" : "closed", "data" : entry.data}; 
		var nodeData = { "data" : entry.data}; 
		$.jstree._reference("#root").create("#root", "last", nodeData, nodeLoadedCallback, true);
		
		//$.jstree._reference("#data_tree_div").create_node(ref, "last", nodeData, nodeLoadedCallback, true);
		
	}
	
}


function nodeLoadedCallback() {
	alert("Node was loaded, now what?");
}


//DEAD CODE!

/*
 * Send a query via ajax that results in html plugged into the given tree node
 */
function sendValueAndLoadTreeNodeAfterErrorCheck(node, pathToLoad) {

	prepareForCall();
	
	var concatPath = "";
	
	for (i = 0; i < pathToLoad.length; i++) {
		concatPath = concatPath + pathToLoad[i];
	}
	
	if (pathToLoad.length == 0) {
		throw ("no path to load");
	}
	
	if (node == null) {
		throw ("null node, no tree node selected");
	}

	var url = context + "/data/data_browser/ajax_data_browser_dir_request";


	try {

		$.get(url, { "dir" : concatPath }, function(data) {
			checkAjaxResultForError(data);
			loadNodeUsingReturnedHtml(data, node);
		}, "html");
		
		$("#javascript_message_area").ajaxError(function(e, xhr, settings, exception) {
			checkAjaxResultForError(xhr.responseText);
		});

	} catch (err) {
		setMessage(err);
		console.log("javascript error:" + err);
	}

}

function loadNodeUsingReturnedHtml(data,node) {
	$.jstree.load_node(node);
	
}


function processReturnedJson(data, type) {
	alert("returned data:" + data);
	return data;
}

function retriveBrowserPath(path) {
	lcSendValueAndPlugHtmlInDiv("", resultDiv, context, postLoadFunction);
}

function nodeSelected(event) {
	//alert("node was selected!");
	var target = event.target;
	var path = $.jstree._reference(target).get_path(target, false);
	// given the path, put in the node data
	var targetNode = $.jstree._reference(target);
	sendValueAndLoadTreeNodeAfterErrorCheck(targetNode, path);

}
